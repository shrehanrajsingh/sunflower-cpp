import '_Native_Socket' as s
import 'thread' as thread

sock = s.socket ()
s.bind (sock, 'localhost', 8000)
s.listen (sock, 10)

fun process (con_sock)
    write ("process():", con_sock)
    req = s.read (con_sock)
    write (req)

    s.send (
        con_sock, 
        "HTTP/1.1 200 OK\r\n" +
        "Content-Length: 13\r\n" +
        "Content-Type: text/plain\r\n\r\n" +
        "Hello, World!"
    )

while 1
    try
        con_sock = s.accept (sock, 'localhost', 8000)
        th = thread (process, [con_sock])
        th.run ()

    catch E
        write ("Error:", E)